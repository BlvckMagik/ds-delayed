#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ñ–∞–π–ª—ñ–≤ –ø–µ—Ä–µ–¥ –∑–±—ñ—Ä–∫–æ—é Docker

echo "–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –∑–±—ñ—Ä–∫–∏ Docker..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤ –∫–æ—Ä–µ–Ω–µ–≤—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ–µ–∫—Ç—É
cd "$(dirname "$0")/.."

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—é—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: package.json –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó"
    exit 1
fi

if [ ! -f "pnpm-lock.yaml" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: pnpm-lock.yaml –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó"
    exit 1
fi

if [ ! -f "pnpm-workspace.yaml" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: pnpm-workspace.yaml –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó"
    exit 1
fi

# –ö–æ–ø—ñ—é—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ –≤ backend/
echo "üìÅ –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –≤ backend/..."
cp package.json backend/
cp pnpm-lock.yaml backend/
cp pnpm-workspace.yaml backend/

echo "‚úÖ –§–∞–π–ª–∏ —É—Å–ø—ñ—à–Ω–æ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ backend/"
echo ""
echo "–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∑–±—ñ—Ä–∫—É Docker:"
echo "cd backend"
echo "docker build -t ds-delayed-backend ."
echo ""
echo "–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∑–±—ñ—Ä–∫–∏:"
echo "./scripts/build-backend.sh" 